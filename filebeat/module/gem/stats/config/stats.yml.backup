type: log
paths:
{{ range $i, $path := .paths }}
 - {{$path}}
{{ end }}

harvester_buffer_size: 70000

close_eof: true
#clean_inactive: 3s
clean_removed: true

exclude_files: [".gz$"]

multiline.pattern: '^-+[\s]*Begin Simulation Statistics[\s]*-+'
multiline.negate: true
multiline.match: after
multiline.flush_pattern: '^-+[\s]*End Simulation Statistics[\s]*-+'

#fields
#tags
#index

processors:
- script:
    lang: javascript
    id: gem_stats
    source: >
      function process(event) {
          var gemStatsMessage = event.Get("message");
          if (gemStatsMessage !== null) {
              var lines = gemStatsMessage.split('\n');
              for(var line in lines) {
                  if(line[0] != "-") {
                      var pos = line.indexOf("#");
                      line = line.slice(0, pos);
                      line = line.split(/[\s]+/);
                      var name = line[0];
                      name = "gem5.stats." + name;
                      for(var i=1;i<line.length-2;++i) {
                          event.AppendTo(name, line[i]);
                      }
                  }
              }
          }
          event.Delete("message");
      }
